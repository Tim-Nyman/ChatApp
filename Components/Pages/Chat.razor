@page "/chat"
@rendermode InteractiveServer
@inject ChatService ChatService

<ChatWindow Messages="messages" OnSendMessage="HandleSendMessage" />

@code {
    private List<ChatWindow.ChatMessage> messages = new();

    protected override async Task OnInitializedAsync()
    {
        ChatService.OnMessageReceived += (user, message) =>
        {
            messages.Add(new ChatWindow.ChatMessage { User = user, Text = message });
            InvokeAsync(StateHasChanged);
        };

        await ChatService.StartAsync();
    }

    private async Task HandleSendMessage(ChatWindow.ChatMessage data)
    {
        await ChatService.SendMessageAsync(data.User, data.Text);
    }
}